name: Facebook AI Bot Auto-Setup
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  build-and-run:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 16

      - name: Unzip and Fix Dependencies
        run: |
          unzip bot.zip
          cd TatsuYTB || cd .
          npm install
          # تثبيت إصدارات متوافقة جداً
          npm install uuid@8.3.2 axios fca-horizon-remastered
          cp ../appstate.json .

      - name: Configure and Fix Login
        run: |
          cd TatsuYTB || cd .
          
          # تعديل config.json
          sed -i 's/"PREFIX": ""/"PREFIX": "."/g' config.json
          sed -i 's/"ADMINBOT": \[ "" \]/"ADMINBOT": [ "100000917675367" ]/g' config.json
          
          # تغيير الـ User-Agent ليكون أكثر استقراراً (أندرويد)
          sed -i 's/Mozilla\/5.0.*/Mozilla\/5.0 (Linux; Android 13; SM-S901B) AppleWebKit\/537.36 (KHTML, like Gecko) Chrome\/112.0.0.0 Mobile Safari\/537.36/g' config.json

      - name: Start Facebook Bot
        run: |
          cd TatsuYTB || cd .
          # تشغيل البوت مع إظهار كل الأخطاء في الشاشة
          DEBUG=fca-horizon-remastered node index.js
